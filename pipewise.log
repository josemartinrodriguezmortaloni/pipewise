2025-07-10 14:04:02,742 - app.api.integrations - WARNING - Generated new Fernet key for development. In production, use PIPEWISE_FERNET_KEY environment variable.
2025-07-10 14:04:04,525 - app.auth.auth_client - INFO - Authentication client initialized
2025-07-10 14:04:05,823 - app.auth.auth_client - INFO - Authentication client initialized
2025-07-10 14:04:05,850 - __main__ - INFO - Full integrations module loaded successfully
2025-07-10 14:04:05,869 - app.core.oauth_config - INFO - 🔧 Checking OAuth environment variables...
2025-07-10 14:04:05,870 - app.core.oauth_config - INFO - 📋 GOOGLE_CLIENT_ID set: True
2025-07-10 14:04:05,870 - app.core.oauth_config - INFO - 📋 GOOGLE_CLIENT_SECRET set: True
2025-07-10 14:04:05,871 - app.core.oauth_config - INFO - 📋 CALENDLY_CLIENT_ID set: True
2025-07-10 14:04:05,871 - app.core.oauth_config - INFO - 📋 CALENDLY_CLIENT_SECRET set: True
2025-07-10 14:04:05,871 - app.core.oauth_config - INFO - 📋 TWITTER_CLIENT_ID set: True
2025-07-10 14:04:05,871 - app.core.oauth_config - INFO - 📋 TWITTER_CLIENT_SECRET set: True
2025-07-10 14:04:05,871 - app.core.oauth_config - INFO - 📋 OAUTH_REDIRECT_BASE_URL set: False
2025-07-10 14:04:05,949 - app.api.oauth_handler - INFO - 🔧 Initializing OAuthHandler...
2025-07-10 14:04:06,625 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 14:04:07,316 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 14:04:07,318 - app.api.oauth_handler - INFO - ✅ Supabase clients initialized successfully
2025-07-10 14:04:07,322 - app.api.oauth_handler - INFO - ✅ OAuthHandler initialized successfully
2025-07-10 14:04:07,360 - __main__ - INFO - OAuth router loaded successfully
2025-07-10 14:04:11,028 - app.ai_agents.mcp.alert_manager - INFO - Added alert rule: Service Unavailable > 2 Minutes (service_unavailable_2min)
2025-07-10 14:04:11,032 - app.ai_agents.mcp.alert_manager - INFO - Added alert rule: API Rate Limit Exceeded (rate_limit_exceeded)
2025-07-10 14:04:11,037 - app.ai_agents.mcp.alert_manager - INFO - Added alert rule: Critical OAuth Authentication Failures (auth_failure_critical)
2025-07-10 14:04:11,052 - app.ai_agents.mcp.alert_manager - INFO - Added alert rule: High Error Rate (high_error_rate)
2025-07-10 14:04:11,058 - app.ai_agents.mcp.alert_manager - INFO - Added alert rule: Performance Degradation (performance_degradation)
2025-07-10 14:04:11,065 - app.ai_agents.mcp.alert_manager - INFO - Added notification channel: default_email
2025-07-10 14:04:11,070 - app.ai_agents.mcp.alert_manager - INFO - Added notification channel: default_slack
2025-07-10 14:04:11,080 - app.ai_agents.mcp.alert_manager - INFO - Added notification channel: default_webhook
2025-07-10 14:04:11,391 - __main__ - INFO - User configuration router loaded successfully
2025-07-10 14:04:11,405 - __main__ - INFO - Starting PipeWise CRM Server with Supabase...
2025-07-10 14:04:11,419 - __main__ - INFO - Server will start on 0.0.0.0:8001
2025-07-10 14:04:11,425 - __main__ - INFO - Running in development mode with auto-reload.
2025-07-10 14:04:11,444 - __main__ - INFO - Access the API documentation at http://localhost:8001/docs
2025-07-10 14:04:11,455 - __main__ - INFO - Features: Supabase Auth, Google Authenticator, 2FA
2025-07-10 14:04:13,235 - server - INFO - Full integrations module loaded successfully
2025-07-10 14:04:13,349 - server - INFO - OAuth router loaded successfully
2025-07-10 14:04:13,404 - server - INFO - User configuration router loaded successfully
2025-07-10 14:04:14,188 - server - INFO - Request: GET /api/api/auth/validate from 127.0.0.1
2025-07-10 14:04:15,951 - server - INFO - Response: 200 in 1.7627s
2025-07-10 14:04:24,524 - server - INFO - Request: POST /api/process-lead-workflow from 127.0.0.1
2025-07-10 14:04:24,525 - server - INFO - 🚀 Processing REAL workflow request
2025-07-10 14:04:24,525 - server - INFO - 📋 Lead data received: {'workflow_type': 'single_lead', 'email': 'lead_josemartinai_001@example.com', 'name': 'lead_josemartinai_001', 'company': '', 'phone': '', 'message': '', 'force_real_workflow': True, 'debug_mode': True}
2025-07-10 14:04:24,780 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 14:04:24,781 - app.ai_agents.memory.in_memory - INFO - InMemoryStore initialized with TTL=3600s
2025-07-10 14:04:24,781 - app.ai_agents.memory.supabase - INFO - SupabaseMemoryStore initialized with table 'agent_memories'
2025-07-10 14:04:24,781 - app.ai_agents.memory.base - INFO - MemoryManager initialized with dual storage
2025-07-10 14:04:24,781 - app.ai_agents.agents - INFO - ModernLeadProcessor initialized with AgentSDK and dual memory system
2025-07-10 14:04:24,781 - app.ai_agents.agents - INFO - 🔧 DEBUG: process_lead_workflow called with workflow_type: single_lead
2025-07-10 14:04:24,781 - app.ai_agents.agents - INFO - 🔧 DEBUG: Lead data keys: ['workflow_type', 'email', 'name', 'company', 'phone', 'message', 'force_real_workflow', 'debug_mode']
2025-07-10 14:04:24,781 - app.ai_agents.agents - INFO - 🔧 DEBUG: Workflow ID: 0e686591-abc7-4ff7-8b64-69e093ab7b6f
2025-07-10 14:04:24,782 - app.ai_agents.agents - INFO - 🔧 DEBUG: User ID: workflow-processor
2025-07-10 14:04:24,782 - app.ai_agents.agents - INFO - 🔧 DEBUG: Debug mode flag: True
2025-07-10 14:04:24,782 - app.ai_agents.agents - INFO - 🔧 DEBUG: Force real workflow flag: True
2025-07-10 14:04:24,782 - app.ai_agents.agents - INFO - 🚀 Starting REAL single_lead workflow 0e686591-abc7-4ff7-8b64-69e093ab7b6f for: lead_josemartinai_001@example.com
2025-07-10 14:04:24,782 - app.ai_agents.agents - INFO - 🔧 DEBUG: This is the REAL AGENT WORKFLOW - NOT SIMPLIFIED
2025-07-10 14:04:25,525 - app.ai_agents.agents - INFO - 🔧 DEBUG: Memory saved, about to create MCP servers
2025-07-10 14:04:25,552 - app.ai_agents.mcp.mcp_server_manager - INFO - 🏭 Creating MCP servers using AgentMCPFactory (user: workflow-processor, agent: None)
2025-07-10 14:04:25,552 - app.ai_agents.mcp.mcp_server_manager - INFO - 🔄 Backward compatibility mode: creating MCPs for all agent types
2025-07-10 14:04:25,552 - app.ai_agents.mcp.agent_mcp_factory - INFO - 🏭 Creating MCP servers for coordinator agent
2025-07-10 14:04:25,552 - app.ai_agents.mcp.agent_mcp_factory - INFO - ℹ️ MCP servers disabled via DISABLE_MCP environment variable
2025-07-10 14:04:25,554 - app.ai_agents.mcp.agent_mcp_factory - INFO - ✅ Created 0 MCP servers for coordinator agent
2025-07-10 14:04:25,554 - app.ai_agents.mcp.agent_mcp_factory - INFO - 🏭 Creating MCP servers for meeting_scheduler agent
2025-07-10 14:04:25,556 - app.ai_agents.mcp.agent_mcp_factory - INFO - ℹ️ MCP servers disabled via DISABLE_MCP environment variable
2025-07-10 14:04:25,558 - app.ai_agents.mcp.agent_mcp_factory - INFO - ✅ Created 0 MCP servers for meeting_scheduler agent
2025-07-10 14:04:25,558 - app.ai_agents.mcp.agent_mcp_factory - INFO - 🏭 Creating MCP servers for lead_administrator agent
2025-07-10 14:04:25,558 - app.ai_agents.mcp.agent_mcp_factory - INFO - ℹ️ MCP servers disabled via DISABLE_MCP environment variable
2025-07-10 14:04:25,560 - app.ai_agents.mcp.agent_mcp_factory - INFO - ✅ Created 0 MCP servers for lead_administrator agent
2025-07-10 14:04:25,560 - app.ai_agents.mcp.mcp_server_manager - INFO - ✅ AgentMCPFactory created 0 unique MCP servers
2025-07-10 14:04:25,563 - app.ai_agents.mcp.mcp_server_manager - INFO - ✅ Created local filesystem MCP server (directory: C:\Users\jmrod\AppData\Local\Temp\pipewise_mcp_rovtdsfo)
2025-07-10 14:04:25,563 - app.ai_agents.agents - INFO - 🔧 DEBUG: Created 1 MCP servers
2025-07-10 14:04:25,563 - app.ai_agents.agents - INFO - 🔧 DEBUG: Attempting to connect MCP servers...
2025-07-10 14:04:30,612 - openai.agents - ERROR - Error initializing MCP server: Timed out while waiting for response to ClientRequest. Waited 5.0 seconds.
2025-07-10 14:04:32,272 - openai.agents - ERROR - Error cleaning up server: unhandled errors in a TaskGroup (1 sub-exception)
2025-07-10 14:04:32,276 - app.ai_agents.mcp.error_handler - WARNING - MCP Error [MEDIUM]: Timeout in connect_server operation on stdio: npx | Code: MCP-TIME-STDI-20250710140432
2025-07-10 14:04:32,276 - app.ai_agents.mcp.mcp_server_manager - WARNING - ⚠️ ⏰ The operation on Stdio: Npx is taking longer than expected. Please try again.
2025-07-10 14:04:32,276 - app.ai_agents.mcp.retry_handler - WARNING - ❌ connect_mcp_servers_properly failed on attempt 1: 🔌 Oops, we couldn't connect to Mcp Servers. Please... Retrying in 1.3s
2025-07-10 14:04:33,553 - app.ai_agents.mcp.retry_handler - INFO - 🔄 Retrying connect_mcp_servers_properly on mcp_connection (attempt 2/3)
2025-07-10 14:04:38,632 - openai.agents - ERROR - Error initializing MCP server: Timed out while waiting for response to ClientRequest. Waited 5.0 seconds.
2025-07-10 14:04:40,763 - app.ai_agents.mcp.error_handler - WARNING - MCP Error [MEDIUM]: Timeout in connect_server operation on stdio: npx | Code: MCP-TIME-STDI-20250710140440
2025-07-10 14:04:40,765 - app.ai_agents.mcp.mcp_server_manager - WARNING - ⚠️ ⏰ The operation on Stdio: Npx is taking longer than expected. Please try again.
2025-07-10 14:04:40,767 - app.ai_agents.mcp.retry_handler - WARNING - ❌ connect_mcp_servers_properly failed on attempt 2: 🔌 Oops, we couldn't connect to Mcp Servers. Please... Retrying in 2.2s
2025-07-10 14:04:43,040 - app.ai_agents.mcp.retry_handler - INFO - 🔄 Retrying connect_mcp_servers_properly on mcp_connection (attempt 3/3)
2025-07-10 14:04:47,297 - app.ai_agents.mcp.mcp_server_manager - INFO - ✅ MCP server connected successfully: stdio: npx
2025-07-10 14:04:47,298 - app.ai_agents.mcp.retry_handler - INFO - ✅ connect_mcp_servers_properly succeeded on attempt 3 after 3.5s total delay
2025-07-10 14:04:47,298 - app.ai_agents.agents - INFO - ✅ Connected 3 MCP servers successfully
2025-07-10 14:04:47,298 - app.ai_agents.agents - INFO - 🔧 DEBUG: About to create agents with memory
2025-07-10 14:04:47,299 - app.ai_agents.agents - INFO - ✅ Loaded prompt from: D:\Mis_Docs\Enprendimiento\Proyectos\pipewise\app\ai_agents\prompts\coordinatorPrompt.md
2025-07-10 14:04:47,300 - app.ai_agents.agents - INFO - ✅ Loaded prompt from: D:\Mis_Docs\Enprendimiento\Proyectos\pipewise\app\ai_agents\prompts\meetingSchedulerPrompt.md
2025-07-10 14:04:47,300 - app.ai_agents.mcp.mcp_server_manager - INFO - 🏭 Creating MCP servers using AgentMCPFactory (user: workflow-processor, agent: None)
2025-07-10 14:04:47,300 - app.ai_agents.mcp.mcp_server_manager - INFO - 🔄 Backward compatibility mode: creating MCPs for all agent types
2025-07-10 14:04:47,300 - app.ai_agents.mcp.agent_mcp_factory - INFO - 🏭 Creating MCP servers for coordinator agent
2025-07-10 14:04:47,302 - app.ai_agents.mcp.agent_mcp_factory - INFO - ℹ️ MCP servers disabled via DISABLE_MCP environment variable
2025-07-10 14:04:47,302 - app.ai_agents.mcp.agent_mcp_factory - INFO - ✅ Created 0 MCP servers for coordinator agent
2025-07-10 14:04:47,302 - app.ai_agents.mcp.agent_mcp_factory - INFO - 🏭 Creating MCP servers for meeting_scheduler agent
2025-07-10 14:04:47,302 - app.ai_agents.mcp.agent_mcp_factory - INFO - ℹ️ MCP servers disabled via DISABLE_MCP environment variable
2025-07-10 14:04:47,302 - app.ai_agents.mcp.agent_mcp_factory - INFO - ✅ Created 0 MCP servers for meeting_scheduler agent
2025-07-10 14:04:47,302 - app.ai_agents.mcp.agent_mcp_factory - INFO - 🏭 Creating MCP servers for lead_administrator agent
2025-07-10 14:04:47,302 - app.ai_agents.mcp.agent_mcp_factory - INFO - ℹ️ MCP servers disabled via DISABLE_MCP environment variable
2025-07-10 14:04:47,304 - app.ai_agents.mcp.agent_mcp_factory - INFO - ✅ Created 0 MCP servers for lead_administrator agent
2025-07-10 14:04:47,304 - app.ai_agents.mcp.mcp_server_manager - INFO - ✅ AgentMCPFactory created 0 unique MCP servers
2025-07-10 14:04:47,305 - app.ai_agents.mcp.mcp_server_manager - INFO - ✅ Created local filesystem MCP server (directory: C:\Users\jmrod\AppData\Local\Temp\pipewise_mcp_vbp9vbud)
2025-07-10 14:04:48,040 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 14:04:49,114 - app.api.oauth_integration_manager - ERROR - ❌ Error getting enabled integrations for user workflow-processor: {'message': 'relation "public.user_integrations" does not exist', 'code': '42P01', 'hint': None, 'details': None}
2025-07-10 14:04:49,115 - app.ai_agents.agents - INFO - ✅ Loaded prompt from: D:\Mis_Docs\Enprendimiento\Proyectos\pipewise\app\ai_agents\prompts\leadAdministratorPrompt.md
2025-07-10 14:04:49,115 - app.ai_agents.agents - INFO - ✅ Created 3 agents with 1 MCP servers
2025-07-10 14:04:49,116 - app.ai_agents.agents - INFO - 🔧 DEBUG: Created 3 agents: ['coordinator', 'lead_administrator', 'meeting_scheduler']
2025-07-10 14:04:49,117 - app.ai_agents.agents - INFO - 🔧 DEBUG: Got coordinator agent: PipeWise Coordinator
2025-07-10 14:04:49,117 - app.ai_agents.agents - INFO - 🔧 DEBUG: Building prompt for workflow type: single_lead
2025-07-10 14:04:49,118 - app.ai_agents.agents - INFO - 🔧 DEBUG: Built workflow prompt with context
2025-07-10 14:04:49,119 - app.ai_agents.agents - INFO - 🔧 DEBUG: About to run coordinator with prompt length: 486
2025-07-10 14:04:49,119 - app.ai_agents.agents - INFO - 🔧 DEBUG: RUNNING REAL AGENT WORKFLOW - NOT SIMPLIFIED
2025-07-10 14:04:49,119 - app.ai_agents.agents - INFO - 🔧 DEBUG: Calling Runner.run with coordinator agent
2025-07-10 14:04:49,124 - app.ai_agents.agents - ERROR - ❌ Error in single_lead workflow 0e686591-abc7-4ff7-8b64-69e093ab7b6f: Server not initialized. Make sure you call `connect()` first.
Traceback (most recent call last):
  File "D:\Mis_Docs\Enprendimiento\Proyectos\pipewise\app\ai_agents\agents.py", line 1025, in process_lead_workflow
    coordinator_result = await Runner.run(coordinator, prompt)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Mis_Docs\Enprendimiento\Proyectos\pipewise\.venv\Lib\site-packages\agents\run.py", line 199, in run
    return await runner.run(
           ^^^^^^^^^^^^^^^^^
  File "D:\Mis_Docs\Enprendimiento\Proyectos\pipewise\.venv\Lib\site-packages\agents\run.py", line 358, in run
    all_tools = await AgentRunner._get_all_tools(current_agent, context_wrapper)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Mis_Docs\Enprendimiento\Proyectos\pipewise\.venv\Lib\site-packages\agents\run.py", line 1107, in _get_all_tools
    return await agent.get_all_tools(context_wrapper)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Mis_Docs\Enprendimiento\Proyectos\pipewise\.venv\Lib\site-packages\agents\agent.py", line 266, in get_all_tools
    mcp_tools = await self.get_mcp_tools()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Mis_Docs\Enprendimiento\Proyectos\pipewise\.venv\Lib\site-packages\agents\agent.py", line 262, in get_mcp_tools
    return await MCPUtil.get_all_function_tools(self.mcp_servers, convert_schemas_to_strict)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Mis_Docs\Enprendimiento\Proyectos\pipewise\.venv\Lib\site-packages\agents\mcp\util.py", line 31, in get_all_function_tools
    server_tools = await cls.get_function_tools(server, convert_schemas_to_strict)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Mis_Docs\Enprendimiento\Proyectos\pipewise\.venv\Lib\site-packages\agents\mcp\util.py", line 50, in get_function_tools
    tools = await server.list_tools()
            ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Mis_Docs\Enprendimiento\Proyectos\pipewise\.venv\Lib\site-packages\agents\mcp\server.py", line 137, in list_tools
    raise UserError("Server not initialized. Make sure you call `connect()` first.")
agents.exceptions.UserError: Server not initialized. Make sure you call `connect()` first.
2025-07-10 14:04:49,418 - server - INFO - ✅ REAL Workflow processed successfully: error
2025-07-10 14:04:49,418 - server - INFO - Response: 200 in 24.8944s
2025-07-10 14:04:59,410 - openai.agents - ERROR - [non-fatal] Tracing client error 400: {
  "error": {
    "message": "Invalid type for 'data[1].span_data.result': expected an array of strings, but got null instead.",
    "type": "invalid_request_error",
    "param": "data[1].span_data.result",
    "code": "invalid_type"
  }
}
2025-07-10 14:07:48,267 - server - INFO - Request: GET /api/api/auth/validate from 127.0.0.1
2025-07-10 14:07:49,263 - server - INFO - Response: 200 in 0.9966s
2025-07-10 14:09:57,135 - server - INFO - Request: GET /api/api/auth/validate from 127.0.0.1
2025-07-10 14:09:57,905 - server - INFO - Response: 200 in 0.7707s
2025-07-10 14:18:35,886 - app.api.integrations - WARNING - Generated new Fernet key for development. In production, use PIPEWISE_FERNET_KEY environment variable.
2025-07-10 14:18:36,461 - app.auth.auth_client - INFO - Authentication client initialized
2025-07-10 14:18:36,951 - app.auth.auth_client - INFO - Authentication client initialized
2025-07-10 14:18:36,959 - __main__ - INFO - Full integrations module loaded successfully
2025-07-10 14:18:36,990 - app.core.oauth_config - INFO - 🔧 Checking OAuth environment variables...
2025-07-10 14:18:36,990 - app.core.oauth_config - INFO - 📋 GOOGLE_CLIENT_ID set: True
2025-07-10 14:18:36,991 - app.core.oauth_config - INFO - 📋 GOOGLE_CLIENT_SECRET set: True
2025-07-10 14:18:36,991 - app.core.oauth_config - INFO - 📋 CALENDLY_CLIENT_ID set: True
2025-07-10 14:18:36,991 - app.core.oauth_config - INFO - 📋 CALENDLY_CLIENT_SECRET set: True
2025-07-10 14:18:36,991 - app.core.oauth_config - INFO - 📋 TWITTER_CLIENT_ID set: True
2025-07-10 14:18:36,991 - app.core.oauth_config - INFO - 📋 TWITTER_CLIENT_SECRET set: True
2025-07-10 14:18:36,991 - app.core.oauth_config - INFO - 📋 OAUTH_REDIRECT_BASE_URL set: False
2025-07-10 14:18:37,063 - app.api.oauth_handler - INFO - 🔧 Initializing OAuthHandler...
2025-07-10 14:18:37,306 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 14:18:37,544 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 14:18:37,544 - app.api.oauth_handler - INFO - ✅ Supabase clients initialized successfully
2025-07-10 14:18:37,544 - app.api.oauth_handler - INFO - ✅ OAuthHandler initialized successfully
2025-07-10 14:18:37,560 - __main__ - INFO - OAuth router loaded successfully
2025-07-10 14:18:40,999 - app.ai_agents.mcp.alert_manager - INFO - Added alert rule: Service Unavailable > 2 Minutes (service_unavailable_2min)
2025-07-10 14:18:40,999 - app.ai_agents.mcp.alert_manager - INFO - Added alert rule: API Rate Limit Exceeded (rate_limit_exceeded)
2025-07-10 14:18:41,000 - app.ai_agents.mcp.alert_manager - INFO - Added alert rule: Critical OAuth Authentication Failures (auth_failure_critical)
2025-07-10 14:18:41,000 - app.ai_agents.mcp.alert_manager - INFO - Added alert rule: High Error Rate (high_error_rate)
2025-07-10 14:18:41,000 - app.ai_agents.mcp.alert_manager - INFO - Added alert rule: Performance Degradation (performance_degradation)
2025-07-10 14:18:41,000 - app.ai_agents.mcp.alert_manager - INFO - Added notification channel: default_email
2025-07-10 14:18:41,002 - app.ai_agents.mcp.alert_manager - INFO - Added notification channel: default_slack
2025-07-10 14:18:41,003 - app.ai_agents.mcp.alert_manager - INFO - Added notification channel: default_webhook
2025-07-10 14:18:41,237 - __main__ - INFO - User configuration router loaded successfully
2025-07-10 14:18:41,243 - __main__ - INFO - Starting PipeWise CRM Server with Supabase...
2025-07-10 14:18:41,246 - __main__ - INFO - Server will start on 0.0.0.0:8001
2025-07-10 14:18:41,250 - __main__ - INFO - Running in development mode with auto-reload.
2025-07-10 14:18:41,253 - __main__ - INFO - Access the API documentation at http://localhost:8001/docs
2025-07-10 14:18:41,257 - __main__ - INFO - Features: Supabase Auth, Google Authenticator, 2FA
2025-07-10 14:18:42,763 - server - INFO - Full integrations module loaded successfully
2025-07-10 14:18:42,785 - server - INFO - OAuth router loaded successfully
2025-07-10 14:18:42,797 - server - INFO - User configuration router loaded successfully
2025-07-10 19:56:11,145 - app.api.integrations - WARNING - Generated new Fernet key for development. In production, use PIPEWISE_FERNET_KEY environment variable.
2025-07-10 19:56:11,852 - app.auth.auth_client - INFO - Authentication client initialized
2025-07-10 19:56:12,415 - app.auth.auth_client - INFO - Authentication client initialized
2025-07-10 19:56:12,425 - __main__ - INFO - Full integrations module loaded successfully
2025-07-10 19:56:12,465 - app.core.oauth_config - INFO - 🔧 Checking OAuth environment variables...
2025-07-10 19:56:12,465 - app.core.oauth_config - INFO - 📋 GOOGLE_CLIENT_ID set: True
2025-07-10 19:56:12,465 - app.core.oauth_config - INFO - 📋 GOOGLE_CLIENT_SECRET set: True
2025-07-10 19:56:12,465 - app.core.oauth_config - INFO - 📋 CALENDLY_CLIENT_ID set: True
2025-07-10 19:56:12,465 - app.core.oauth_config - INFO - 📋 CALENDLY_CLIENT_SECRET set: True
2025-07-10 19:56:12,466 - app.core.oauth_config - INFO - 📋 TWITTER_CLIENT_ID set: True
2025-07-10 19:56:12,467 - app.core.oauth_config - INFO - 📋 TWITTER_CLIENT_SECRET set: True
2025-07-10 19:56:12,467 - app.core.oauth_config - INFO - 📋 OAUTH_REDIRECT_BASE_URL set: False
2025-07-10 19:56:12,581 - app.api.oauth_handler - INFO - 🔧 Initializing OAuthHandler...
2025-07-10 19:56:12,835 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 19:56:13,156 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 19:56:13,156 - app.api.oauth_handler - INFO - ✅ Supabase clients initialized successfully
2025-07-10 19:56:13,156 - app.api.oauth_handler - INFO - ✅ OAuthHandler initialized successfully
2025-07-10 19:56:13,172 - __main__ - INFO - OAuth router loaded successfully
2025-07-10 19:56:19,228 - app.ai_agents.mcp.alert_manager - INFO - Added alert rule: Service Unavailable > 2 Minutes (service_unavailable_2min)
2025-07-10 19:56:19,229 - app.ai_agents.mcp.alert_manager - INFO - Added alert rule: API Rate Limit Exceeded (rate_limit_exceeded)
2025-07-10 19:56:19,229 - app.ai_agents.mcp.alert_manager - INFO - Added alert rule: Critical OAuth Authentication Failures (auth_failure_critical)
2025-07-10 19:56:19,229 - app.ai_agents.mcp.alert_manager - INFO - Added alert rule: High Error Rate (high_error_rate)
2025-07-10 19:56:19,229 - app.ai_agents.mcp.alert_manager - INFO - Added alert rule: Performance Degradation (performance_degradation)
2025-07-10 19:56:19,229 - app.ai_agents.mcp.alert_manager - INFO - Added notification channel: default_email
2025-07-10 19:56:19,229 - app.ai_agents.mcp.alert_manager - INFO - Added notification channel: default_slack
2025-07-10 19:56:19,229 - app.ai_agents.mcp.alert_manager - INFO - Added notification channel: default_webhook
2025-07-10 19:56:19,382 - __main__ - INFO - User configuration router loaded successfully
2025-07-10 19:56:19,383 - __main__ - INFO - Starting PipeWise CRM Server with Supabase...
2025-07-10 19:56:19,383 - __main__ - INFO - Server will start on 0.0.0.0:8001
2025-07-10 19:56:19,383 - __main__ - INFO - Running in development mode with auto-reload.
2025-07-10 19:56:19,383 - __main__ - INFO - Access the API documentation at http://localhost:8001/docs
2025-07-10 19:56:19,383 - __main__ - INFO - Features: Supabase Auth, Google Authenticator, 2FA
2025-07-10 19:56:20,295 - server - INFO - Full integrations module loaded successfully
2025-07-10 19:56:20,303 - server - INFO - OAuth router loaded successfully
2025-07-10 19:56:20,307 - server - INFO - User configuration router loaded successfully
2025-07-10 19:56:56,952 - server - INFO - Request: OPTIONS /api/api/auth/validate from 127.0.0.1
2025-07-10 19:56:56,953 - server - INFO - Response: 200 in 0.0010s
2025-07-10 19:56:56,956 - server - INFO - Request: GET /api/api/auth/validate from 127.0.0.1
2025-07-10 19:56:58,263 - server - INFO - Response: 200 in 1.3077s
2025-07-10 19:56:58,289 - server - INFO - Request: GET /api/api/auth/validate from 127.0.0.1
2025-07-10 19:56:59,085 - server - INFO - Response: 200 in 0.7952s
2025-07-10 19:57:08,537 - server - INFO - Request: GET /api/api/auth/validate from 127.0.0.1
2025-07-10 19:57:09,760 - server - INFO - Response: 200 in 1.2235s
2025-07-10 19:57:09,762 - server - INFO - Request: OPTIONS /api/leads from 127.0.0.1
2025-07-10 19:57:09,766 - server - INFO - Request: OPTIONS /api/analytics/leads from 127.0.0.1
2025-07-10 19:57:09,768 - server - INFO - Request: OPTIONS /api/leads from 127.0.0.1
2025-07-10 19:57:09,769 - server - INFO - Request: OPTIONS /api/leads from 127.0.0.1
2025-07-10 19:57:09,769 - server - INFO - Response: 200 in 0.0070s
2025-07-10 19:57:09,769 - server - INFO - Request: OPTIONS /api/leads from 127.0.0.1
2025-07-10 19:57:09,771 - server - INFO - Response: 200 in 0.0045s
2025-07-10 19:57:09,772 - server - INFO - Request: OPTIONS /api/analytics/leads from 127.0.0.1
2025-07-10 19:57:09,774 - server - INFO - Response: 200 in 0.0055s
2025-07-10 19:57:09,776 - server - INFO - Response: 200 in 0.0065s
2025-07-10 19:57:09,778 - server - INFO - Response: 200 in 0.0085s
2025-07-10 19:57:09,780 - server - INFO - Response: 200 in 0.0080s
2025-07-10 19:57:09,782 - server - INFO - Request: GET /api/leads from 127.0.0.1
2025-07-10 19:57:11,061 - server - INFO - Obteniendo leads para usuario 9e6fd7a1-d7b4-4f50-baa5-4c4d867a9ba4
2025-07-10 19:57:11,642 - server - INFO - Request: GET /api/leads from 127.0.0.1
2025-07-10 19:57:12,418 - server - INFO - Obteniendo leads para usuario 9e6fd7a1-d7b4-4f50-baa5-4c4d867a9ba4
2025-07-10 19:57:12,653 - server - INFO - Response: 200 in 2.8709s
2025-07-10 19:57:12,654 - server - INFO - Response: 200 in 1.0124s
2025-07-10 19:57:12,657 - server - INFO - Request: GET /api/analytics/leads from 127.0.0.1
2025-07-10 19:57:13,338 - server - INFO - Response: 200 in 0.6808s
2025-07-10 19:57:13,339 - server - INFO - Request: GET /api/leads from 127.0.0.1
2025-07-10 19:57:13,339 - server - INFO - Request: GET /api/leads from 127.0.0.1
2025-07-10 19:57:14,102 - server - INFO - Obteniendo leads para usuario 9e6fd7a1-d7b4-4f50-baa5-4c4d867a9ba4
2025-07-10 19:57:15,082 - server - INFO - Obteniendo leads para usuario 9e6fd7a1-d7b4-4f50-baa5-4c4d867a9ba4
2025-07-10 19:57:15,620 - server - INFO - Response: 200 in 2.2811s
2025-07-10 19:57:15,624 - server - INFO - Response: 200 in 2.2846s
2025-07-10 19:57:15,628 - server - INFO - Request: GET /api/leads from 127.0.0.1
2025-07-10 19:57:16,063 - server - INFO - Obteniendo leads para usuario 9e6fd7a1-d7b4-4f50-baa5-4c4d867a9ba4
2025-07-10 19:57:16,284 - server - INFO - Response: 200 in 0.6563s
2025-07-10 19:57:18,200 - server - INFO - Request: GET /api/api/auth/validate from 127.0.0.1
2025-07-10 19:57:18,700 - server - INFO - Response: 200 in 0.5005s
2025-07-10 19:57:44,166 - server - INFO - Request: GET /api/api/auth/validate from 127.0.0.1
2025-07-10 19:57:44,751 - server - INFO - Response: 200 in 0.5848s
2025-07-10 19:58:48,625 - server - INFO - Request: POST /api/process-lead-workflow from 127.0.0.1
2025-07-10 19:58:48,626 - server - INFO - 🚀 Processing REAL workflow request
2025-07-10 19:58:48,626 - server - INFO - 📋 Lead data received: {'workflow_type': 'single_lead', 'email': 'josemartinai@example.com', 'name': 'josemartinai', 'company': 'PipeWise', 'phone': '', 'message': '', 'force_real_workflow': True, 'debug_mode': True}
2025-07-10 19:58:48,925 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 19:58:48,926 - app.ai_agents.memory.in_memory - INFO - InMemoryStore initialized with TTL=3600s
2025-07-10 19:58:48,926 - app.ai_agents.memory.supabase - INFO - SupabaseMemoryStore initialized with table 'agent_memories'
2025-07-10 19:58:48,926 - app.ai_agents.memory.base - INFO - MemoryManager initialized with dual storage
2025-07-10 19:58:48,926 - app.ai_agents.agents - INFO - ModernLeadProcessor initialized with AgentSDK and dual memory system
2025-07-10 19:58:48,926 - app.ai_agents.agents - INFO - 🔧 DEBUG: process_lead_workflow called with workflow_type: single_lead
2025-07-10 19:58:48,927 - app.ai_agents.agents - INFO - 🔧 DEBUG: Lead data keys: ['workflow_type', 'email', 'name', 'company', 'phone', 'message', 'force_real_workflow', 'debug_mode']
2025-07-10 19:58:48,927 - app.ai_agents.agents - INFO - 🔧 DEBUG: Workflow ID: ceef7dbc-cd5a-4b34-b47d-b8ab1fca5f3b
2025-07-10 19:58:48,927 - app.ai_agents.agents - INFO - 🔧 DEBUG: User ID: workflow-processor
2025-07-10 19:58:48,927 - app.ai_agents.agents - INFO - 🔧 DEBUG: Debug mode flag: True
2025-07-10 19:58:48,927 - app.ai_agents.agents - INFO - 🔧 DEBUG: Force real workflow flag: True
2025-07-10 19:58:48,927 - app.ai_agents.agents - INFO - 🚀 Starting REAL single_lead workflow ceef7dbc-cd5a-4b34-b47d-b8ab1fca5f3b for: josemartinai@example.com
2025-07-10 19:58:48,927 - app.ai_agents.agents - INFO - 🔧 DEBUG: This is the REAL AGENT WORKFLOW - NOT SIMPLIFIED
2025-07-10 19:58:49,726 - app.ai_agents.agents - INFO - 🔧 DEBUG: Memory saved, about to create MCP servers
2025-07-10 19:58:49,789 - app.ai_agents.mcp.mcp_server_manager - INFO - 🏭 Creating MCP servers using AgentMCPFactory (user: workflow-processor, agent: None)
2025-07-10 19:58:49,789 - app.ai_agents.mcp.mcp_server_manager - INFO - 🔄 Backward compatibility mode: creating MCPs for all agent types
2025-07-10 19:58:49,789 - app.ai_agents.mcp.agent_mcp_factory - INFO - 🏭 Creating MCP servers for coordinator agent
2025-07-10 19:58:50,072 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 19:58:50,687 - app.ai_agents.mcp.mcp_server_manager - WARNING - ⚠️ Error validating OAuth tokens: {'message': 'relation "public.oauth_integrations" does not exist', 'code': '42P01', 'hint': None, 'details': None}
2025-07-10 19:58:50,687 - app.ai_agents.mcp.mcp_server_manager - INFO - 📋 Using demo mode for sendgrid, user workflow-processor
2025-07-10 19:58:50,992 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 19:58:51,562 - app.ai_agents.mcp.mcp_server_manager - WARNING - ⚠️ Error validating OAuth tokens: {'message': 'relation "public.oauth_integrations" does not exist', 'code': '42P01', 'hint': None, 'details': None}
2025-07-10 19:58:51,562 - app.ai_agents.mcp.mcp_server_manager - INFO - 📋 Using demo mode for twitter, user workflow-processor
2025-07-10 19:58:51,562 - app.ai_agents.mcp.mcp_server_manager - INFO - ✅ 2 services have valid OAuth tokens: sendgrid, twitter
2025-07-10 19:58:51,872 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 19:58:52,915 - app.api.oauth_integration_manager - ERROR - ❌ Error getting integration tokens for sendgrid: {'message': 'invalid input syntax for type uuid: "workflow-processor"', 'code': '22P02', 'hint': None, 'details': None}
2025-07-10 19:58:53,227 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 19:58:53,812 - app.api.oauth_integration_manager - ERROR - ❌ Error getting integration tokens for twitter: {'message': 'invalid input syntax for type uuid: "workflow-processor"', 'code': '22P02', 'hint': None, 'details': None}
2025-07-10 19:58:53,812 - app.ai_agents.mcp.agent_mcp_factory - INFO - ✅ Successfully created 0 MCP servers
2025-07-10 19:58:53,812 - app.ai_agents.mcp.agent_mcp_factory - INFO - ✅ Created 0 MCP servers for coordinator agent
2025-07-10 19:58:53,812 - app.ai_agents.mcp.agent_mcp_factory - INFO - 🏭 Creating MCP servers for meeting_scheduler agent
2025-07-10 19:58:54,162 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 19:58:54,779 - app.ai_agents.mcp.mcp_server_manager - WARNING - ⚠️ Error validating OAuth tokens: {'message': 'relation "public.oauth_integrations" does not exist', 'code': '42P01', 'hint': None, 'details': None}
2025-07-10 19:58:54,779 - app.ai_agents.mcp.mcp_server_manager - INFO - 📋 Using demo mode for calendly_v2, user workflow-processor
2025-07-10 19:58:55,032 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 19:58:55,550 - app.ai_agents.mcp.mcp_server_manager - WARNING - ⚠️ Error validating OAuth tokens: {'message': 'relation "public.oauth_integrations" does not exist', 'code': '42P01', 'hint': None, 'details': None}
2025-07-10 19:58:55,550 - app.ai_agents.mcp.mcp_server_manager - INFO - 📋 Using demo mode for google_calendar, user workflow-processor
2025-07-10 19:58:55,550 - app.ai_agents.mcp.mcp_server_manager - INFO - ✅ 2 services have valid OAuth tokens: calendly_v2, google_calendar
2025-07-10 19:58:55,807 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 19:58:56,343 - app.api.oauth_integration_manager - ERROR - ❌ Error getting integration tokens for calendly_v2: {'message': 'invalid input syntax for type uuid: "workflow-processor"', 'code': '22P02', 'hint': None, 'details': None}
2025-07-10 19:58:56,589 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 19:58:57,130 - app.api.oauth_integration_manager - ERROR - ❌ Error getting integration tokens for google_calendar: {'message': 'invalid input syntax for type uuid: "workflow-processor"', 'code': '22P02', 'hint': None, 'details': None}
2025-07-10 19:58:57,130 - app.ai_agents.mcp.agent_mcp_factory - INFO - ✅ Successfully created 0 MCP servers
2025-07-10 19:58:57,131 - app.ai_agents.mcp.agent_mcp_factory - INFO - ✅ Created 0 MCP servers for meeting_scheduler agent
2025-07-10 19:58:57,131 - app.ai_agents.mcp.agent_mcp_factory - INFO - 🏭 Creating MCP servers for lead_administrator agent
2025-07-10 19:58:57,382 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 19:58:57,909 - app.ai_agents.mcp.mcp_server_manager - WARNING - ⚠️ Error validating OAuth tokens: {'message': 'relation "public.oauth_integrations" does not exist', 'code': '42P01', 'hint': None, 'details': None}
2025-07-10 19:58:58,161 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 19:58:58,763 - app.ai_agents.mcp.mcp_server_manager - WARNING - ⚠️ Error validating OAuth tokens: {'message': 'relation "public.oauth_integrations" does not exist', 'code': '42P01', 'hint': None, 'details': None}
2025-07-10 19:58:59,028 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 19:58:59,544 - app.ai_agents.mcp.mcp_server_manager - WARNING - ⚠️ Error validating OAuth tokens: {'message': 'relation "public.oauth_integrations" does not exist', 'code': '42P01', 'hint': None, 'details': None}
2025-07-10 19:58:59,545 - app.ai_agents.mcp.mcp_server_manager - INFO - 🔒 Filtered out 3 services without valid OAuth: zoho_crm, salesforce_rest_api, pipedrive
2025-07-10 19:58:59,545 - app.ai_agents.mcp.agent_mcp_factory - INFO - ℹ️ No services with valid OAuth tokens for user workflow-processor
2025-07-10 19:58:59,545 - app.ai_agents.mcp.agent_mcp_factory - INFO - ✅ Created 0 MCP servers for lead_administrator agent
2025-07-10 19:58:59,545 - app.ai_agents.mcp.mcp_server_manager - INFO - ✅ AgentMCPFactory created 0 unique MCP servers
2025-07-10 19:58:59,550 - app.ai_agents.mcp.mcp_server_manager - INFO - ℹ️ npm/npx not available - skipping local MCP server creation
2025-07-10 19:58:59,550 - app.ai_agents.mcp.mcp_server_manager - INFO - 💡 Install Node.js with npm from https://nodejs.org/ to enable MCP filesystem server
2025-07-10 19:58:59,550 - app.ai_agents.agents - INFO - 🔧 DEBUG: Created 0 MCP servers
2025-07-10 19:58:59,550 - app.ai_agents.agents - INFO - 🔧 DEBUG: About to create agents with memory
2025-07-10 19:58:59,551 - app.ai_agents.agents - INFO - ✅ Loaded prompt from: D:\Mis_Docs\Enprendimiento\Proyectos\pipewise\app\ai_agents\prompts\coordinatorPrompt.md
2025-07-10 19:58:59,551 - app.ai_agents.agents - INFO - ✅ Loaded prompt from: D:\Mis_Docs\Enprendimiento\Proyectos\pipewise\app\ai_agents\prompts\meetingSchedulerPrompt.md
2025-07-10 19:58:59,804 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 19:59:00,378 - app.api.oauth_integration_manager - ERROR - ❌ Error getting enabled integrations for user workflow-processor: {'message': 'invalid input syntax for type uuid: "workflow-processor"', 'code': '22P02', 'hint': None, 'details': None}
2025-07-10 19:59:00,378 - app.ai_agents.agents - INFO - 🔧 Using 0 connected MCP servers for agents
2025-07-10 19:59:00,379 - app.ai_agents.agents - INFO - ✅ Loaded prompt from: D:\Mis_Docs\Enprendimiento\Proyectos\pipewise\app\ai_agents\prompts\leadAdministratorPrompt.md
2025-07-10 19:59:00,379 - app.ai_agents.agents - INFO - 🔧 DEBUG: Created 3 agents: ['coordinator', 'lead_administrator', 'meeting_scheduler']
2025-07-10 19:59:00,379 - app.ai_agents.agents - INFO - 🔧 DEBUG: Got coordinator agent: PipeWise Coordinator
2025-07-10 19:59:00,379 - app.ai_agents.agents - INFO - 🔧 DEBUG: Building prompt for workflow type: single_lead
2025-07-10 19:59:00,379 - app.ai_agents.agents - INFO - 🔧 DEBUG: Built workflow prompt with context
2025-07-10 19:59:00,379 - app.ai_agents.agents - INFO - 🔧 DEBUG: About to run coordinator with prompt length: 476
2025-07-10 19:59:00,380 - app.ai_agents.agents - INFO - 🔧 DEBUG: RUNNING REAL AGENT WORKFLOW - NOT SIMPLIFIED
2025-07-10 19:59:00,380 - app.ai_agents.agents - INFO - 🔧 DEBUG: Calling Runner.run with coordinator agent
2025-07-10 19:59:12,202 - app.ai_agents.agents - INFO - 🔧 DEBUG: Runner.run completed successfully
2025-07-10 19:59:12,205 - app.ai_agents.agents - INFO - ✅ REAL single_lead workflow completed: RunResult:
- Last agent: Agent(name="PipeWise Coordinator", ...)
- Final output (str):
    ¡Perfecto! Voy a iniciar el flujo correcto para el procesamiento de un lead individual, siguiendo las mejores prácticas detalladas arriba.
    
    ### 1. VERIFICACIÓN DEL LEAD Y CONTEXTO INICIAL
    
    **Datos recibidos:**
    - Nombre: josemartinai
    - Email: josemartinai@example.com
    - Empresa: PipeWise
    - Teléfono: (no disponible)
    - Mensaje: (no provisto)
    
    ### 2. MENSAJE DE CONTACTO INICIAL
    
    Como la información es limitada (no hay mensaje de contexto ni teléfono), realizaré el primer contacto vía email. Sin embargo, actualmente no hay servidores MCP de email disponibles para envío automático, por lo que no puedo enviar el mensaje directamente.
    
    ---
    
    #### 📧 **MODELO DE MENSAJE QUE DEBERÍAS ENVIAR MANUALMENTE:**
    
    ---
    
    Asunto: ¡Hola, josemartinai! — Queremos conocer más sobre tus necesidades en PipeWise
    
    Hola josemartinai,
    
    Soy el equipo de PipeWise CRM. Notamos que has mostrado interés en nuestras soluciones y nos encantaría conocer un poco más sobre tu empresa y tus objetivos.
    
    ¿Podrías contarnos brevemente qué desafíos principales enfrenta PipeWise actualmente y qué tipo de solución estás buscando?  
    Esto nos permitirá recomendarte la mejor configuración posible y asegurarnos de que nuestro equipo pueda apoyarte de manera personalizada.
    
    Además, si tienes preferencia sobre cómo y cuándo te gustaría conversar, ¡házmelo saber! Podemos agendar una llamada, reunión virtual o simplemente conversar por correo.
    
    ¡Quedo atento a tus comentarios!
    
    Un cordial saludo,  
    Equipo PipeWise CRM
    
    ---
    
    #### 📌 **Próximos pasos:**
    1. Esperar respuesta para construir la conversación.
    2. En la siguiente interacción, recopilar información detallada sobre:
       - Cargo/rol
       - Industria
       - Principales desafíos
       - Urgencia/timeline
       - Presupuesto aproximado
       - Interés en agendar reunión
    
    ---
    
    **Nota:** No se ha creado ningún registro de base de datos ni se ha hecho calificación aún; se prioriza el contacto y construcción de la relación primero.
    
    ¿Quieres que te ayude a redactar un mensaje más personalizado o tienes otro canal disponible para contactar a josemartinai?
- 1 new item(s)
- 1 raw response(s)
- 0 input guardrail result(s)
- 0 output guardrail result(s)
(See `RunResult` for more details)
2025-07-10 19:59:12,524 - app.ai_agents.agents - INFO - 🔧 DEBUG: Final result prepared and saved to memory
2025-07-10 19:59:12,525 - server - INFO - ✅ REAL Workflow processed successfully: completed
2025-07-10 19:59:12,527 - server - INFO - Response: 200 in 23.9020s
2025-07-10 20:10:33,408 - server - INFO - Request: OPTIONS /api/api/auth/validate from 127.0.0.1
2025-07-10 20:10:33,408 - server - INFO - Response: 200 in 0.0010s
2025-07-10 20:10:33,410 - server - INFO - Request: GET /api/api/auth/validate from 127.0.0.1
2025-07-10 20:10:34,208 - server - INFO - Response: 200 in 0.7974s
2025-07-10 20:10:36,477 - server - INFO - Request: GET /api/api/auth/validate from 127.0.0.1
2025-07-10 20:10:36,899 - server - INFO - Response: 200 in 0.4235s
2025-07-10 20:14:04,570 - server - INFO - Request: GET /api/api/auth/validate from 127.0.0.1
2025-07-10 20:14:05,648 - server - INFO - Response: 200 in 1.0781s
2025-07-10 20:17:50,308 - server - INFO - Request: GET /api/api/auth/validate from 127.0.0.1
2025-07-10 20:17:51,799 - server - INFO - Response: 200 in 1.4909s
2025-07-10 20:17:56,011 - server - INFO - Request: GET /api/api/auth/validate from 127.0.0.1
2025-07-10 20:17:56,768 - server - INFO - Response: 200 in 0.7581s
2025-07-10 20:17:56,959 - server - INFO - Request: GET /api/api/auth/validate from 127.0.0.1
2025-07-10 20:17:57,730 - server - INFO - Response: 200 in 0.7711s
2025-07-10 20:18:14,658 - server - INFO - Request: GET /api/api/auth/validate from 127.0.0.1
2025-07-10 20:18:15,381 - server - INFO - Response: 200 in 0.7228s
2025-07-10 20:19:11,874 - server - INFO - Request: POST /api/process-lead-workflow from 127.0.0.1
2025-07-10 20:19:11,875 - server - INFO - 🚀 Processing REAL workflow request
2025-07-10 20:19:11,875 - server - INFO - 📋 Lead data received: {'workflow_type': 'single_lead', 'email': 'lead-josemartinai-20240611-001@example.com', 'name': 'lead-josemartinai-20240611-001', 'company': '', 'phone': '', 'message': '', 'force_real_workflow': True, 'debug_mode': True}
2025-07-10 20:19:12,157 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:19:12,157 - app.ai_agents.memory.in_memory - INFO - InMemoryStore initialized with TTL=3600s
2025-07-10 20:19:12,157 - app.ai_agents.memory.supabase - INFO - SupabaseMemoryStore initialized with table 'agent_memories'
2025-07-10 20:19:12,157 - app.ai_agents.memory.base - INFO - MemoryManager initialized with dual storage
2025-07-10 20:19:12,157 - app.ai_agents.agents - INFO - ModernLeadProcessor initialized with AgentSDK and dual memory system
2025-07-10 20:19:12,158 - app.ai_agents.agents - INFO - 🔧 DEBUG: process_lead_workflow called with workflow_type: single_lead
2025-07-10 20:19:12,158 - app.ai_agents.agents - INFO - 🔧 DEBUG: Lead data keys: ['workflow_type', 'email', 'name', 'company', 'phone', 'message', 'force_real_workflow', 'debug_mode']
2025-07-10 20:19:12,158 - app.ai_agents.agents - INFO - 🔧 DEBUG: Workflow ID: 41ac9281-f4cd-4821-9899-35b02b27a13e
2025-07-10 20:19:12,158 - app.ai_agents.agents - INFO - 🔧 DEBUG: User ID: workflow-processor
2025-07-10 20:19:12,158 - app.ai_agents.agents - INFO - 🔧 DEBUG: Debug mode flag: True
2025-07-10 20:19:12,159 - app.ai_agents.agents - INFO - 🔧 DEBUG: Force real workflow flag: True
2025-07-10 20:19:12,159 - app.ai_agents.agents - INFO - 🚀 Starting REAL single_lead workflow 41ac9281-f4cd-4821-9899-35b02b27a13e for: lead-josemartinai-20240611-001@example.com
2025-07-10 20:19:12,159 - app.ai_agents.agents - INFO - 🔧 DEBUG: This is the REAL AGENT WORKFLOW - NOT SIMPLIFIED
2025-07-10 20:19:13,073 - app.ai_agents.agents - INFO - 🔧 DEBUG: Memory saved, about to create MCP servers
2025-07-10 20:19:13,073 - app.ai_agents.mcp.mcp_server_manager - INFO - 🏭 Creating MCP servers using AgentMCPFactory (user: workflow-processor, agent: None)
2025-07-10 20:19:13,073 - app.ai_agents.mcp.mcp_server_manager - INFO - 🔄 Backward compatibility mode: creating MCPs for all agent types
2025-07-10 20:19:13,074 - app.ai_agents.mcp.agent_mcp_factory - INFO - 🏭 Creating MCP servers for coordinator agent
2025-07-10 20:19:13,342 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:19:14,187 - app.ai_agents.mcp.mcp_server_manager - WARNING - ⚠️ Error validating OAuth tokens: {'message': 'relation "public.oauth_integrations" does not exist', 'code': '42P01', 'hint': None, 'details': None}
2025-07-10 20:19:14,188 - app.ai_agents.mcp.mcp_server_manager - INFO - 📋 Using demo mode for sendgrid, user workflow-processor
2025-07-10 20:19:14,443 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:19:14,989 - app.ai_agents.mcp.mcp_server_manager - WARNING - ⚠️ Error validating OAuth tokens: {'message': 'relation "public.oauth_integrations" does not exist', 'code': '42P01', 'hint': None, 'details': None}
2025-07-10 20:19:14,989 - app.ai_agents.mcp.mcp_server_manager - INFO - 📋 Using demo mode for twitter, user workflow-processor
2025-07-10 20:19:14,990 - app.ai_agents.mcp.mcp_server_manager - INFO - ✅ 2 services have valid OAuth tokens: sendgrid, twitter
2025-07-10 20:19:15,246 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:19:15,800 - app.api.oauth_integration_manager - ERROR - ❌ Error getting integration tokens for sendgrid: {'message': 'invalid input syntax for type uuid: "workflow-processor"', 'code': '22P02', 'hint': None, 'details': None}
2025-07-10 20:19:16,050 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:19:16,651 - app.api.oauth_integration_manager - ERROR - ❌ Error getting integration tokens for twitter: {'message': 'invalid input syntax for type uuid: "workflow-processor"', 'code': '22P02', 'hint': None, 'details': None}
2025-07-10 20:19:16,651 - app.ai_agents.mcp.agent_mcp_factory - INFO - ✅ Successfully created 0 MCP servers
2025-07-10 20:19:16,651 - app.ai_agents.mcp.agent_mcp_factory - INFO - ✅ Created 0 MCP servers for coordinator agent
2025-07-10 20:19:16,652 - app.ai_agents.mcp.agent_mcp_factory - INFO - 🏭 Creating MCP servers for meeting_scheduler agent
2025-07-10 20:19:16,954 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:19:17,831 - app.ai_agents.mcp.mcp_server_manager - WARNING - ⚠️ Error validating OAuth tokens: {'message': 'relation "public.oauth_integrations" does not exist', 'code': '42P01', 'hint': None, 'details': None}
2025-07-10 20:19:17,832 - app.ai_agents.mcp.mcp_server_manager - INFO - 📋 Using demo mode for calendly_v2, user workflow-processor
2025-07-10 20:19:18,099 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:19:18,630 - app.ai_agents.mcp.mcp_server_manager - WARNING - ⚠️ Error validating OAuth tokens: {'message': 'relation "public.oauth_integrations" does not exist', 'code': '42P01', 'hint': None, 'details': None}
2025-07-10 20:19:18,630 - app.ai_agents.mcp.mcp_server_manager - INFO - 📋 Using demo mode for google_calendar, user workflow-processor
2025-07-10 20:19:18,630 - app.ai_agents.mcp.mcp_server_manager - INFO - ✅ 2 services have valid OAuth tokens: calendly_v2, google_calendar
2025-07-10 20:19:18,937 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:19:19,510 - app.api.oauth_integration_manager - ERROR - ❌ Error getting integration tokens for calendly_v2: {'message': 'invalid input syntax for type uuid: "workflow-processor"', 'code': '22P02', 'hint': None, 'details': None}
2025-07-10 20:19:19,771 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:19:20,312 - app.api.oauth_integration_manager - ERROR - ❌ Error getting integration tokens for google_calendar: {'message': 'invalid input syntax for type uuid: "workflow-processor"', 'code': '22P02', 'hint': None, 'details': None}
2025-07-10 20:19:20,312 - app.ai_agents.mcp.agent_mcp_factory - INFO - ✅ Successfully created 0 MCP servers
2025-07-10 20:19:20,312 - app.ai_agents.mcp.agent_mcp_factory - INFO - ✅ Created 0 MCP servers for meeting_scheduler agent
2025-07-10 20:19:20,313 - app.ai_agents.mcp.agent_mcp_factory - INFO - 🏭 Creating MCP servers for lead_administrator agent
2025-07-10 20:19:20,582 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:19:21,324 - app.ai_agents.mcp.mcp_server_manager - WARNING - ⚠️ Error validating OAuth tokens: {'message': 'relation "public.oauth_integrations" does not exist', 'code': '42P01', 'hint': None, 'details': None}
2025-07-10 20:19:21,955 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:19:22,842 - app.ai_agents.mcp.mcp_server_manager - WARNING - ⚠️ Error validating OAuth tokens: {'message': 'relation "public.oauth_integrations" does not exist', 'code': '42P01', 'hint': None, 'details': None}
2025-07-10 20:19:23,459 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:19:24,341 - app.ai_agents.mcp.mcp_server_manager - WARNING - ⚠️ Error validating OAuth tokens: {'message': 'relation "public.oauth_integrations" does not exist', 'code': '42P01', 'hint': None, 'details': None}
2025-07-10 20:19:24,342 - app.ai_agents.mcp.mcp_server_manager - INFO - 🔒 Filtered out 3 services without valid OAuth: zoho_crm, salesforce_rest_api, pipedrive
2025-07-10 20:19:24,342 - app.ai_agents.mcp.agent_mcp_factory - INFO - ℹ️ No services with valid OAuth tokens for user workflow-processor
2025-07-10 20:19:24,342 - app.ai_agents.mcp.agent_mcp_factory - INFO - ✅ Created 0 MCP servers for lead_administrator agent
2025-07-10 20:19:24,343 - app.ai_agents.mcp.mcp_server_manager - INFO - ✅ AgentMCPFactory created 0 unique MCP servers
2025-07-10 20:19:24,348 - app.ai_agents.mcp.mcp_server_manager - INFO - ℹ️ npm/npx not available - skipping local MCP server creation
2025-07-10 20:19:24,349 - app.ai_agents.mcp.mcp_server_manager - INFO - 💡 Install Node.js with npm from https://nodejs.org/ to enable MCP filesystem server
2025-07-10 20:19:24,349 - app.ai_agents.agents - INFO - 🔧 DEBUG: Created 0 MCP servers
2025-07-10 20:19:24,349 - app.ai_agents.agents - INFO - 🔧 DEBUG: About to create agents with memory
2025-07-10 20:19:24,350 - app.ai_agents.agents - INFO - ✅ Loaded prompt from: D:\Mis_Docs\Enprendimiento\Proyectos\pipewise\app\ai_agents\prompts\coordinatorPrompt.md
2025-07-10 20:19:24,351 - app.ai_agents.agents - INFO - ✅ Loaded prompt from: D:\Mis_Docs\Enprendimiento\Proyectos\pipewise\app\ai_agents\prompts\meetingSchedulerPrompt.md
2025-07-10 20:19:25,028 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:19:26,092 - app.api.oauth_integration_manager - ERROR - ❌ Error getting enabled integrations for user workflow-processor: {'message': 'invalid input syntax for type uuid: "workflow-processor"', 'code': '22P02', 'hint': None, 'details': None}
2025-07-10 20:19:26,093 - app.ai_agents.agents - INFO - 🔧 Using 0 connected MCP servers for agents
2025-07-10 20:19:26,093 - app.ai_agents.agents - INFO - ✅ Loaded prompt from: D:\Mis_Docs\Enprendimiento\Proyectos\pipewise\app\ai_agents\prompts\leadAdministratorPrompt.md
2025-07-10 20:19:26,094 - app.ai_agents.agents - INFO - 🔧 DEBUG: Created 3 agents: ['coordinator', 'lead_administrator', 'meeting_scheduler']
2025-07-10 20:19:26,094 - app.ai_agents.agents - INFO - 🔧 DEBUG: Got coordinator agent: PipeWise Coordinator
2025-07-10 20:19:26,094 - app.ai_agents.agents - INFO - 🔧 DEBUG: Building prompt for workflow type: single_lead
2025-07-10 20:19:26,094 - app.ai_agents.agents - INFO - 🔧 DEBUG: Built workflow prompt with context
2025-07-10 20:19:26,095 - app.ai_agents.agents - INFO - 🔧 DEBUG: About to run coordinator with prompt length: 504
2025-07-10 20:19:26,095 - app.ai_agents.agents - INFO - 🔧 DEBUG: RUNNING REAL AGENT WORKFLOW - NOT SIMPLIFIED
2025-07-10 20:19:26,095 - app.ai_agents.agents - INFO - 🔧 DEBUG: Calling Runner.run with coordinator agent
2025-07-10 20:19:36,508 - app.ai_agents.agents - INFO - 🔧 DEBUG: Runner.run completed successfully
2025-07-10 20:19:36,509 - app.ai_agents.agents - INFO - ✅ REAL single_lead workflow completed: RunResult:
- Last agent: Agent(name="PipeWise Coordinator", ...)
- Final output (str):
    ¡Perfecto! Has activado el **workflow de contacto individual para un lead único**. Sigo las mejores prácticas del flujo “single_lead” para PipeWise CRM.
    
    ### 🔗 Contexto del lead recibido:
    - **Email:** lead-josemartinai-20240611-001@example.com
    - **Nombre:** lead-josemartinai-20240611-001
    - **Empresa:** (No especificada)
    - **Teléfono:** (No especificado)
    - **Mensaje inicial:** (Vacío)
    
    ---
    
    ## 🛠️ Próximos pasos según protocolo:
    
    1. **Contacto inmediato:** La mejor vía disponible es el email.
    2. **Construcción de relación:** Iniciaré conversación profesional para entender necesidades y recopilar datos clave antes de cualquier registro formal.
    3. **Recopilación de información crítica**:
       - Nombre y empresa formal (si es distinto al handle)
       - Rol y principales desafíos
       - Tipo de servicio buscado y contexto de negocio
       - Preferencia por reunión, urgencia, presupuesto y tomadores de decisión
    
    ---
    
    ## 📩 Mensaje inicial sugerido para enviar por email:
    
    ```
    Asunto: ¡Bienvenido a PipeWise CRM! Queremos ayudarte a crecer
    
    ¡Hola, [nombre]! Soy parte del equipo de PipeWise CRM y vi que has mostrado interés en explorar soluciones CRM.
    
    Para poder ayudarte de la mejor manera, ¿podrías contarme un poco más sobre tu empresa y la razón por la que buscas un CRM en este momento? Me gustaría saber:
    - ¿A qué se dedica tu organización?
    - ¿Cuál es tu rol dentro de ella?
    - ¿Cuáles son los principales desafíos que buscas resolver?
    - ¿Tienes alguna expectativa de tiempo o presupuesto?
    - ¿Te interesaría agendar una reunión para analizar una solución a la medida?
    
    Quedo atento para apoyarte en lo que necesites.
    
    ¡Gracias y saludos!
    ```
    
    ---
    
    ### ⚡ Importante:
    - **No crearé registros en la base de datos ni transferiré este lead a especialistas aún**, ya que la información crítica es insuficiente.
    - Si el cliente responde, recopilaré los datos y haré handoff al especialista adecuado con el contexto completo.
    - No se puede realizar ningún envío real (outreach) ya que NO hay servidores MCP disponibles para email en este momento.
    
    ---
    
    ## 🛑 Limitación Técnica
    Actualmente no hay servidores MCP disponibles, por lo que no puedo enviar el mensaje de contacto directamente ni usar canales automáticos de outreach. Recomiendo que este contacto se haga manualmente (puedo facilitarte el texto exacto para que lo envíes).
    
    ¿Te gustaría que adapte el mensaje o necesitas apoyo para otro canal? ¿Prefieres que te envíe el texto para que lo compartas manualmente?
- 1 new item(s)
- 1 raw response(s)
- 0 input guardrail result(s)
- 0 output guardrail result(s)
(See `RunResult` for more details)
2025-07-10 20:19:37,174 - app.ai_agents.agents - INFO - 🔧 DEBUG: Final result prepared and saved to memory
2025-07-10 20:19:37,175 - server - INFO - ✅ REAL Workflow processed successfully: completed
2025-07-10 20:19:37,175 - server - INFO - Response: 200 in 25.3011s
2025-07-10 20:19:55,801 - server - INFO - Request: GET /api/api/auth/validate from 127.0.0.1
2025-07-10 20:19:56,699 - server - INFO - Response: 200 in 0.8982s
2025-07-10 20:40:34,427 - server - INFO - Request: OPTIONS /api/api/auth/validate from 127.0.0.1
2025-07-10 20:40:34,427 - server - INFO - Response: 200 in 0.0000s
2025-07-10 20:40:34,429 - server - INFO - Request: GET /api/api/auth/validate from 127.0.0.1
2025-07-10 20:40:36,405 - server - INFO - Response: 200 in 1.9757s
2025-07-10 20:40:39,163 - server - INFO - Request: GET /api/api/auth/validate from 127.0.0.1
2025-07-10 20:40:39,867 - server - INFO - Response: 200 in 0.7039s
2025-07-10 20:40:40,673 - server - INFO - Request: GET /api/api/auth/validate from 127.0.0.1
2025-07-10 20:40:41,139 - server - INFO - Response: 200 in 0.4659s
2025-07-10 20:40:46,782 - server - INFO - Request: POST /api/process-lead-workflow from 127.0.0.1
2025-07-10 20:40:46,784 - server - INFO - 🚀 Processing REAL workflow request
2025-07-10 20:40:46,785 - server - INFO - 📋 Lead data received: {'workflow_type': 'single_lead', 'email': 'lead-josemartinai-20240611@example.com', 'name': 'lead-josemartinai-20240611', 'company': '', 'phone': '', 'message': 'Somos una empresa que desarrolla agentes de inteligencia artificial adaptados a las necesidades de los clientes.', 'force_real_workflow': True, 'debug_mode': True}
2025-07-10 20:40:47,199 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:40:47,200 - app.ai_agents.memory.in_memory - INFO - InMemoryStore initialized with TTL=3600s
2025-07-10 20:40:47,200 - app.ai_agents.memory.supabase - INFO - SupabaseMemoryStore initialized with table 'agent_memories'
2025-07-10 20:40:47,200 - app.ai_agents.memory.base - INFO - MemoryManager initialized with dual storage
2025-07-10 20:40:47,200 - app.ai_agents.agents - INFO - ModernLeadProcessor initialized with AgentSDK and dual memory system
2025-07-10 20:40:47,200 - app.ai_agents.agents - INFO - 🔧 DEBUG: process_lead_workflow called with workflow_type: single_lead
2025-07-10 20:40:47,200 - app.ai_agents.agents - INFO - 🔧 DEBUG: Lead data keys: ['workflow_type', 'email', 'name', 'company', 'phone', 'message', 'force_real_workflow', 'debug_mode']
2025-07-10 20:40:47,200 - app.ai_agents.agents - INFO - 🔧 DEBUG: Workflow ID: c099f88d-64a4-48f1-825f-d4a1befe3d03
2025-07-10 20:40:47,201 - app.ai_agents.agents - INFO - 🔧 DEBUG: User ID: workflow-processor
2025-07-10 20:40:47,201 - app.ai_agents.agents - INFO - 🔧 DEBUG: Debug mode flag: True
2025-07-10 20:40:47,201 - app.ai_agents.agents - INFO - 🔧 DEBUG: Force real workflow flag: True
2025-07-10 20:40:47,201 - app.ai_agents.agents - INFO - 🚀 Starting REAL single_lead workflow c099f88d-64a4-48f1-825f-d4a1befe3d03 for: lead-josemartinai-20240611@example.com
2025-07-10 20:40:47,201 - app.ai_agents.agents - INFO - 🔧 DEBUG: This is the REAL AGENT WORKFLOW - NOT SIMPLIFIED
2025-07-10 20:40:48,002 - app.ai_agents.agents - INFO - 🔧 DEBUG: Memory saved, about to create MCP servers
2025-07-10 20:40:48,003 - app.ai_agents.mcp.mcp_server_manager - INFO - 🏭 Creating MCP servers using AgentMCPFactory (user: workflow-processor, agent: None)
2025-07-10 20:40:48,003 - app.ai_agents.mcp.mcp_server_manager - INFO - 🔄 Backward compatibility mode: creating MCPs for all agent types
2025-07-10 20:40:48,003 - app.ai_agents.mcp.agent_mcp_factory - INFO - 🏭 Creating MCP servers for coordinator agent
2025-07-10 20:40:48,667 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:40:49,615 - app.ai_agents.mcp.mcp_server_manager - WARNING - ⚠️ Error validating OAuth tokens: {'message': 'relation "public.oauth_integrations" does not exist', 'code': '42P01', 'hint': None, 'details': None}
2025-07-10 20:40:49,615 - app.ai_agents.mcp.mcp_server_manager - INFO - 📋 Using demo mode for sendgrid, user workflow-processor
2025-07-10 20:40:49,969 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:40:50,842 - app.ai_agents.mcp.mcp_server_manager - WARNING - ⚠️ Error validating OAuth tokens: {'message': 'relation "public.oauth_integrations" does not exist', 'code': '42P01', 'hint': None, 'details': None}
2025-07-10 20:40:50,843 - app.ai_agents.mcp.mcp_server_manager - INFO - 📋 Using demo mode for twitter, user workflow-processor
2025-07-10 20:40:50,844 - app.ai_agents.mcp.mcp_server_manager - INFO - ✅ 2 services have valid OAuth tokens: sendgrid, twitter
2025-07-10 20:40:51,295 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:40:52,281 - app.api.oauth_integration_manager - ERROR - ❌ Error getting integration tokens for sendgrid: {'message': 'invalid input syntax for type uuid: "workflow-processor"', 'code': '22P02', 'hint': None, 'details': None}
2025-07-10 20:40:52,908 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:40:54,598 - app.api.oauth_integration_manager - ERROR - ❌ Error getting integration tokens for twitter: {'message': 'invalid input syntax for type uuid: "workflow-processor"', 'code': '22P02', 'hint': None, 'details': None}
2025-07-10 20:40:54,599 - app.ai_agents.mcp.agent_mcp_factory - INFO - ✅ Successfully created 0 MCP servers
2025-07-10 20:40:54,600 - app.ai_agents.mcp.agent_mcp_factory - INFO - ✅ Created 0 MCP servers for coordinator agent
2025-07-10 20:40:54,600 - app.ai_agents.mcp.agent_mcp_factory - INFO - 🏭 Creating MCP servers for meeting_scheduler agent
2025-07-10 20:40:55,280 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:40:56,489 - app.ai_agents.mcp.mcp_server_manager - WARNING - ⚠️ Error validating OAuth tokens: {'message': 'relation "public.oauth_integrations" does not exist', 'code': '42P01', 'hint': None, 'details': None}
2025-07-10 20:40:56,489 - app.ai_agents.mcp.mcp_server_manager - INFO - 📋 Using demo mode for calendly_v2, user workflow-processor
2025-07-10 20:40:57,247 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:40:58,343 - app.ai_agents.mcp.mcp_server_manager - WARNING - ⚠️ Error validating OAuth tokens: {'message': 'relation "public.oauth_integrations" does not exist', 'code': '42P01', 'hint': None, 'details': None}
2025-07-10 20:40:58,346 - app.ai_agents.mcp.mcp_server_manager - INFO - 📋 Using demo mode for google_calendar, user workflow-processor
2025-07-10 20:40:58,346 - app.ai_agents.mcp.mcp_server_manager - INFO - ✅ 2 services have valid OAuth tokens: calendly_v2, google_calendar
2025-07-10 20:40:58,951 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:40:59,568 - app.api.oauth_integration_manager - ERROR - ❌ Error getting integration tokens for calendly_v2: {'message': 'invalid input syntax for type uuid: "workflow-processor"', 'code': '22P02', 'hint': None, 'details': None}
2025-07-10 20:41:00,182 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:41:01,232 - app.api.oauth_integration_manager - ERROR - ❌ Error getting integration tokens for google_calendar: {'message': 'invalid input syntax for type uuid: "workflow-processor"', 'code': '22P02', 'hint': None, 'details': None}
2025-07-10 20:41:01,233 - app.ai_agents.mcp.agent_mcp_factory - INFO - ✅ Successfully created 0 MCP servers
2025-07-10 20:41:01,233 - app.ai_agents.mcp.agent_mcp_factory - INFO - ✅ Created 0 MCP servers for meeting_scheduler agent
2025-07-10 20:41:01,233 - app.ai_agents.mcp.agent_mcp_factory - INFO - 🏭 Creating MCP servers for lead_administrator agent
2025-07-10 20:41:01,915 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:41:02,904 - app.ai_agents.mcp.mcp_server_manager - WARNING - ⚠️ Error validating OAuth tokens: {'message': 'relation "public.oauth_integrations" does not exist', 'code': '42P01', 'hint': None, 'details': None}
2025-07-10 20:41:03,556 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:41:04,630 - app.ai_agents.mcp.mcp_server_manager - WARNING - ⚠️ Error validating OAuth tokens: {'message': 'relation "public.oauth_integrations" does not exist', 'code': '42P01', 'hint': None, 'details': None}
2025-07-10 20:41:05,366 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:41:06,461 - app.ai_agents.mcp.mcp_server_manager - WARNING - ⚠️ Error validating OAuth tokens: {'message': 'relation "public.oauth_integrations" does not exist', 'code': '42P01', 'hint': None, 'details': None}
2025-07-10 20:41:06,463 - app.ai_agents.mcp.mcp_server_manager - INFO - 🔒 Filtered out 3 services without valid OAuth: zoho_crm, salesforce_rest_api, pipedrive
2025-07-10 20:41:06,465 - app.ai_agents.mcp.agent_mcp_factory - INFO - ℹ️ No services with valid OAuth tokens for user workflow-processor
2025-07-10 20:41:06,465 - app.ai_agents.mcp.agent_mcp_factory - INFO - ✅ Created 0 MCP servers for lead_administrator agent
2025-07-10 20:41:06,465 - app.ai_agents.mcp.mcp_server_manager - INFO - ✅ AgentMCPFactory created 0 unique MCP servers
2025-07-10 20:41:06,470 - app.ai_agents.mcp.mcp_server_manager - INFO - ℹ️ npm/npx not available - skipping local MCP server creation
2025-07-10 20:41:06,473 - app.ai_agents.mcp.mcp_server_manager - INFO - 💡 Install Node.js with npm from https://nodejs.org/ to enable MCP filesystem server
2025-07-10 20:41:06,473 - app.ai_agents.agents - INFO - 🔧 DEBUG: Created 0 MCP servers
2025-07-10 20:41:06,474 - app.ai_agents.agents - INFO - 🔧 DEBUG: About to create agents with memory
2025-07-10 20:41:06,476 - app.ai_agents.agents - INFO - ✅ Loaded prompt from: D:\Mis_Docs\Enprendimiento\Proyectos\pipewise\app\ai_agents\prompts\coordinatorPrompt.md
2025-07-10 20:41:06,477 - app.ai_agents.agents - INFO - ✅ Loaded prompt from: D:\Mis_Docs\Enprendimiento\Proyectos\pipewise\app\ai_agents\prompts\meetingSchedulerPrompt.md
2025-07-10 20:41:07,257 - app.supabase.supabase_client - INFO - Supabase CRM Client initialized
2025-07-10 20:41:08,570 - app.api.oauth_integration_manager - ERROR - ❌ Error getting enabled integrations for user workflow-processor: {'message': 'invalid input syntax for type uuid: "workflow-processor"', 'code': '22P02', 'hint': None, 'details': None}
2025-07-10 20:41:08,571 - app.ai_agents.agents - INFO - 🔧 Using 0 connected MCP servers for agents
2025-07-10 20:41:08,575 - app.ai_agents.agents - INFO - ✅ Loaded prompt from: D:\Mis_Docs\Enprendimiento\Proyectos\pipewise\app\ai_agents\prompts\leadAdministratorPrompt.md
2025-07-10 20:41:08,575 - app.ai_agents.agents - INFO - 🔧 DEBUG: Created 3 agents: ['coordinator', 'lead_administrator', 'meeting_scheduler']
2025-07-10 20:41:08,576 - app.ai_agents.agents - INFO - 🔧 DEBUG: Got coordinator agent: PipeWise Coordinator
2025-07-10 20:41:08,576 - app.ai_agents.agents - INFO - 🔧 DEBUG: Building prompt for workflow type: single_lead
2025-07-10 20:41:08,578 - app.ai_agents.agents - INFO - 🔧 DEBUG: Built workflow prompt with context
2025-07-10 20:41:08,578 - app.ai_agents.agents - INFO - 🔧 DEBUG: About to run coordinator with prompt length: 608
2025-07-10 20:41:08,578 - app.ai_agents.agents - INFO - 🔧 DEBUG: RUNNING REAL AGENT WORKFLOW - NOT SIMPLIFIED
2025-07-10 20:41:08,578 - app.ai_agents.agents - INFO - 🔧 DEBUG: Calling Runner.run with coordinator agent
2025-07-10 20:41:16,489 - app.ai_agents.agents - INFO - 🔧 DEBUG: Runner.run completed successfully
2025-07-10 20:41:16,490 - app.ai_agents.agents - INFO - ✅ REAL single_lead workflow completed: RunResult:
- Last agent: Agent(name="PipeWise Coordinator", ...)
- Final output (str):
    ¡Gracias por la información! Voy a iniciar el proceso de contacto y recopilación de información, siguiendo el workflow para “single_lead”.
    
    ---
    
    ### Mensaje de Contacto (Ejemplo para Email)
    
    Hola,  
    Soy parte del equipo de PipeWise CRM. Muchas gracias por contactarnos y compartir que su empresa desarrolla agentes de inteligencia artificial adaptados a las necesidades de sus clientes. 
    
    Para poder ofrecerles la mejor solución y recomendaciones personalizadas, ¿podría compartirme un poco más sobre ustedes y sus necesidades? Me gustaría conocer:
    
    - Nombre completo del contacto principal
    - Nombre de la empresa y sector en el que operan
    - Su rol o responsabilidad en la organización
    - ¿Cuáles son los principales desafíos que enfrentan actualmente en la gestión de clientes o procesos internos?
    - ¿Qué tipo de soluciones están buscando específicamente?
    - ¿Tienen algún timeline o urgencia para implementar una nueva solución?
    - ¿Cuál es el presupuesto aproximado que consideran?
    - ¿Desean agendar una reunión para explorar opciones, ya sea una llamada de demostración o una consulta ejecutiva?
    
    ¡Quedo atento a su respuesta para acompañarles en todo el proceso! Si prefieren agendar una llamada directamente, también puedo compartirles opciones de reunión.
    
    ---
    
    **Siguientes pasos:**
    - Esperaré la respuesta para construir la relación y recopilar la información completa.
    - Una vez tenga los datos clave, realizaré handoff al leadGenerator, siguiendo el flujo operativo de PipeWise CRM.
    
    ¿Quieres que contacte a este lead por un canal específico (por ejemplo, email o redes sociales) o deseas adaptar el mensaje antes de que lo envíe (simulación en modo debug)?
- 1 new item(s)
- 1 raw response(s)
- 0 input guardrail result(s)
- 0 output guardrail result(s)
(See `RunResult` for more details)
2025-07-10 20:41:17,052 - app.ai_agents.agents - INFO - 🔧 DEBUG: Final result prepared and saved to memory
2025-07-10 20:41:17,053 - server - INFO - ✅ REAL Workflow processed successfully: completed
2025-07-10 20:41:17,054 - server - INFO - Response: 200 in 30.2714s
